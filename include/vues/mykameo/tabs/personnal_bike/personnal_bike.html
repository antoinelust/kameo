<div class="tab-pane" id="personnalBike">

  <img class="img-responsive img-rounded center" id='personnalBikeImg' alt="Image of Bike">
  <br />
  <!-- BIKE DESCRIPTION -->
  <div class="table-responsive">
    <table class="table table-striped" id="personnalBikeDataTable">
      <h4 class="text-green"> <?= L::bike_description_title; ?> </h4>
      <tbody>
        <tr>
          <td><?= L::bike_description_model; ?></td>
          <td class="brandModelPersonnalBike"></td>
        </tr>
        <tr>
          <td><?= L::bike_description_contract_start; ?></td>
          <td class="contractStartPersonnalBike"></td>
        </tr>
        <tr>
          <td><?= L::bike_description_contract_end; ?></td>
          <td class="contractEndPersonnalbike"></td>
        </tr>
      </tbody>
    </table>
    <a data-target="#calculRachatVeloPersonalTab" class='calculRachatVeloPersonalTabLink text-green' data-toggle="modal" href="#"><?= L::rachatBike_url; ?></a><br><br>
  </div>
  <div class="separator"></div>

  <h4 class="text-green"><?= L::personnalTab_actionsTaken; ?></h4>
  <table class="table table-striped" id="personnalBikeActionTable" style="width:100%" >
  </table>

  <div class="separator"></div>
  <h4 class="text-green"><?= L::documentation_actiris_link_title; ?></h4>
  <div class="col-md-12" id='documentationPersonnalBike'>
  </div>

</div>


<script type="text/javascript">
  function load_personnal_bike(){
    $.ajax({
      url: "apis/Kameo/get_bike_details.php",
      type: "get",
      success: function (response) {
        if (response.response == "error") {
          console.log(response.message);
        } else {
          $('.brandModelPersonnalBike').html(response.brand+" "+response.modelCatalog);
          $('.contractStartPersonnalBike').html(response.contractStart);
          $('.contractEndPersonnalbike').html(response.contractEnd);
          $('.calculRachatVeloPersonalTabLink').attr("leasingPrice", response.leasingPrice);
          $('.calculRachatVeloPersonalTabLink').attr("catalogprice", response.catalogPrice);
          $('.calculRachatVeloPersonalTabLink').attr("catalogprice", response.catalogPrice);
          $('#personnalBikeImg').attr('src', "images_bikes/"+response.img+".jpg");
          if(response.brand=="Kayza"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/KAYZA_USER.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Bzen"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/BZEN_USER.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Conway"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/CONWAY_EBIKE.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Douze"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/DOUZE_G4.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Moustache Bikes"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/MOUSTACHE_USER.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="HNF Nicolai"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/HNF_XD2.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Victoria"){
            $('#documentationPersonnalBike').append("<a href='docs/modeemploi/VICTORIA_USER.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
          }else if(response.brand=="Ahooga"){
            if(response.modelCatalog=="Folding Bike" || response.modelCatalog=="Folding Bike Power"){
              $('#documentationPersonnalBike').append("<a href='docs/modeemploi/AHOOGA_FOLDING.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
            }else{
              $('#documentationPersonnalBike').append("<a href='docs/modeemploi/AHOOGA_MODULAR.pdf' target='_blank'><i class='fa fa-file-pdf-o fa-3' aria-hidden='true'> "+traduction.documentation_actiris_link_title+" "+response.brand+"</i></a>");
            }
          }
        }
      }
    });


    $.ajax({
       url: "apis/Kameo/action_bike_management.php",
       type: "post",
       data: {
         "readActionBike-action": "read",
       },
       success : function(data) {
         $('#personnalBikeActionTable').dataTable( {
         destroy: true,
         responsive: true,
         bInfo : false,
         paging: false,
         searching: false,
         data : data.action,
         columns: [
         {
            title: "Date",
            data: "date",
            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
              $(nTd).html(sData.substring(0, 10));
            },
          },
          {
             title: "Description",
             data: "title",
             fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
               if (sData == 'maintenance') $(nTd).html("Entretien fait");
               else if(sData == 'maintenance')$(nTd).html(description);
             },
           }
         ],
         order: [
           [0, "desc"]
         ]
        });
       }
     });



  }
  load_personnal_bike();

  $( ".calculRachatVeloPersonalTabLink" ).click(function() {
    $('#valeurRachatTablePesonnalTab').html("");
    var parent = document.createElement("tr");
    var cell = document.createElement("th");
    cell.innerHTML="Mois";
    parent.append(cell);
    var cell = document.createElement("th");
    cell.innerHTML="Valeur de Rachat (TVAC)";
    parent.append(cell);
    $('#valeurRachatTablePesonnalTab').append(parent);


    var leasingprice=this.getAttribute('leasingPrice');
    var catalogPrice=this.getAttribute('catalogprice');
    for(i=12; i<37; i++){
      var parent = document.createElement("tr");
      var cell = document.createElement("td");
      if(i==12){
        cell.innerHTML="Mois [1-12]";
      }else{
        cell.innerHTML="Mois "+i;
      }
      parent.append(cell);
      var cell = document.createElement("td");
      if(i==12){
        cell.innerHTML=Math.round(catalogPrice*1.21)+" €";
      }else{
        cell.innerHTML=Math.round((0.6*(36-i)*leasingprice*1.21 + 0.16*catalogPrice)*1.21)+" €";
      }
      parent.append(cell);
      $('#valeurRachatTablePesonnalTab').append(parent);
    }
  })

</script>
