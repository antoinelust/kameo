<div class="modal fade" id="usersListing" tabindex="2" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="z-index: 1043; display: none; overflow-y: auto !important;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      </div>
      <div data-example-id="contextual-table" class="bs-example">
        <a class="button small green button-3d rounded icon-right" data-target="#addUser" data-toggle="modal" onclick="create_user()" href="#"><i class="fa fa-plus"></i><?= L::generic_addUser; ?></a>
        <table class="table" id="usersList" style='width: 100%;'></table>
      </div>

      <script>
        $(".usersManagerClick").click(function () {
          $.ajax({
             url: "apis/Kameo/get_users_listing",
             success : function(data) {
              $('#usersList').dataTable( {
                destroy: true,
                sAjaxDataProp: "",
                data : data.users,
                columns: [
                 { title: traduction.sidebar_last_name, data: "name" },
                 { title: traduction.sidebar_first_name, data: "firstName" },
                 { className: "hidden-xs", title: "E-Mail", data: "email" },
                 {
                   title: traduction.generic_status,
                   data: "staann",
                   fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                     if (sData !== null) $(nTd).html("Actif");
                     else $(nTd).html("Inactif");
                   },
                 },
                 {
                   data: "email",
                   fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                     $(nTd).html("<a href='#' data-target='#updateUserInformation' onclick=\"update_user_information('" +
                       sData +
                       "')\" class='text-green' data-toggle='modal'>"+traduction.generic_update+" </a>");
                     },
                  }

                ],
                order: [
                 [0, "asc"]
                ]
              });
           }
          });
        });
      </script>

      <div class="modal-footer">
        <button type="button" class="btn btn-b" data-dismiss="modal"><?= L::generic_close; ?></button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="addUser" tabindex="-1" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="z-index: 2000; display: none; overflow-y: auto !important;">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-sm-12">
						<h4 class="text-green"><?= L::generic_addUser; ?></h4>
            <form id="widget-addUser-form" action="apis/Kameo/add_user.php" role="form" method="post">
							<div class="form-group col-sm-12">
                <div class="row">
  								<div class="col-md-4">
  									<label for="firstname"><?= L::sidebar_first_name; ?></label>
  									<input type="text" name="firstName" class="form-control required">
  								</div>
  								<div class="col-md-4">
                    <label for="name"><?= L::sidebar_last_name; ?></label>
  									<input type="text" name="name" class="form-control required">
  								</div>
  								<div class="col-md-4">
  									<label for="mail">E-mail</label>
  									<input type="text" name="mail" class="form-control mail required">
  								</div>
                </div>
                <div class="row">
  								<div class="col-md-4">
                    <label for="phone"><?= L::sidebar_phone; ?></label>
  									<input type="text" name="phone" class="form-control phone">
  								</div>
  								<div class="col-md-4">
  									<label for="generatePassword" class="text-center"><?= L::generic_generatePassword; ?></label>
  									<input type="checkbox" name="generatePassword" class="form-control" checked>
  								</div>
  								<div class="col-md-4">
  									<label for="password" class="hidden"><?= L::sidebar_password; ?></label>
  									<input type="password" name="password" id="manual_password" class="form-control required hidden" autocomplete="off">
  								</div>
                </div>
                <div class="row">
  								<div class="col-md-4">
                    <label for="fleetManager" class="text-center">Fleet manager</label>
  									<input type="checkbox" name="fleetManager" class="form-control">
  								</div>
                </div>
                <div class="row">
  								<div class="col-md-4">
                    <label for="sendMail" class="text-center"><?= L::generic_sendEmail; ?></label>
  									<input type="checkbox" name="sendMail" class="form-control" checked>
  								</div>
                </div>
								<input type="text" name="requestor" class="form-control hidden" value="<?php echo $user_data['EMAIL']; ?>">
								<input type="text" name="company" class="form-control hidden">
							</div>
							<h4 class="accessToBuildings text-green"><?= L::generic_accessToBuildings; ?></h4>
							<div class="form-group col-sm-12 accessToBuildings" id="buildingCreateUser"></div>
              <h4 class="text-green accessToBikes"><?= L::generic_accessToBikes; ?></h4>
							<div class="col-sm-12 accessToBikes"><input type="checkbox" id="select-all" name="select_all" checked /> <strong><?= L::generic_selectAll; ?></strong></div>
							<div class="form-group col-sm-12 accessToBikes" id="bikeCreateUser"></div>
							<div id="confirmAddUser"></div>
						</form>
					</div>
				</div>
			</div>
			<div class="fr" class="modal-footer">
				<button type="button" class="btn btn-b" data-dismiss="modal"><?= L::generic_close; ?></button>
			</div>
		</div>
	</div>
</div>
<script
  type="text/javascript"
  src="js/addons/jquery-datatables-checkboxes/js/dataTables.checkboxes.min.js"
></script>
<!--<script type="text/javascript" src="js/addons/tweetnacl/nacl-fast.min.js"></script>
<script type="text/javascript" src="js/addons/tweetnacl-util/nacl-util.min.js"></script>-->
<script type="text/javascript">
	$('#widget-addUser-form input[name=generatePassword]').change(function(){
	 if($('#widget-addUser-form input[name=generatePassword').is(':checked')){
		$('#widget-addUser-form label[for=password]').addClass("hidden");
		$('#widget-addUser-form input[name=password]').addClass("hidden");
	 }else{
		$('#widget-addUser-form label[for=password]').removeClass("hidden");
		$('#widget-addUser-form input[name=password]').removeClass("hidden");
	 }
	});
	jQuery("#widget-addUser-form").submit(function() {
	  document.getElementById('manual_password').value = /*nacl.util.encodeBase64(
		  nacl.hash(
			  nacl.util.decodeUTF8(*/
				document.getElementById('manual_password').value
			  /*)
		  )
	  )*/;
	  return true;
	});
	jQuery("#widget-addUser-form").validate({
	 submitHandler: function(form) {
		jQuery(form).ajaxSubmit({
		 success: function(response) {
			if (response.response == 'success') {
			 $.notify({
				message: response.message
			 }, {
				type: 'success'
			 });
			 get_users_listing();
			 $('#addUser').modal('toggle');
			 document.getElementById('widget-addUser-form').reset();

			} else {
			 $.notify({
				message: response.message
			 }, {
				type: 'danger'
			 });
			}
		 }
		});
	 }
	});
</script>
