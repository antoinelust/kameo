<div class="modal fade" id="maintenanceManagementItem" tabindex="-1" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none; overflow-y: auto !important">
<div class="modal-dialog modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-sm-12">
        <h4 class="text-green maintenanceManagementTitle"> Éditer un entretien </h4>
        <form id="widget-maintenanceManagement-form" action="api/maintenances" role="form" method="post" >
          <div class="form-group col-sm-12">
            <div class="col-md-12">
              <div class="col-md-4" name="id">
                <label for="ID">ID</label>
                <input type="int" title="ID" class="form-control required" name="ID" readonly="readonly" />
              </div>
              <div class="col-md-4">
                <label for="utilisateur">Société</label>
                <select title="company" class="form-control required form_company" name="company"></select>
              </div>
              <div class="col-md-4">
                <br>
                <a class="button small green button-3d rounded icon-right addCompany" data-target="#addClient" data-toggle="modal" href="#">Ajouter un client </a>
              </div>
            </div>
            <div class="col-md-12">
               <div class="col-md-4">
                <label for="utilisateur">Vélo</label>
                <select title="velo" class="form-control required form_velo" name="velo" ></select>
              </div>
              <div class="col-md-4" name="addExternalBikesDiv">
                <br>
                <a class="button small green button-3d rounded icon-right addExternalBikes" data-target="#externalBikeManagement" data-action="add" data-toggle="modal" href="#">
                  Ajouter un Vélo
                </a>
              </div>
            </div>
            <div class="col-md-12">
              <div class="col-md-4">
                <label for="utilisateur">Status</label>
                <select title="status" class="form-control required" name="status" >
                  <option value="CONFIRMED">CONFIRMED</option>
                  <option value="AUTOMATICALY_PLANNED">AUTOMATICALY_PLANNED</option>
                  <option value="MANUALLY_PLANNED">MANUALLY_PLANNED</option>
                  <option value="DONE">DONE</option>
                  <option value="CANCELLED">CANCELLED</option>
                  <option value="IN_SHOP">IN_SHOP</option>
                  <option value="TO_PLAN">TO_PLAN</option>
                  <option value="WAITING_PIECES">WAITING_PIECES</option>
                  <option value="DELIVERED_TO_CLIENT">DELIVERED_TO_CLIENT</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="dateMaintenance">Date d'entretien</label>
                <input type="date" title="dateMaintenance" name="dateMaintenance" class="form-control required" />
              </div>
              <div class="col-md-4">
                <label for="dateOutPlanned">Date de sortie planifié</label>
                <input type="date" title="dateOutPlanned" name="dateOutPlanned" class="form-control required" />
              </div>
              <div class="col-md-4 text-center">
                <label for="maintenanceatKAMEO">Entretien à l'atelier ?</label>
                <input type="checkbox" name="maintenanceatKAMEO" class="form-control">
                <label for="address">Adresse : </label>
                <input type="text" name="address" class="form-control">
              </div>
              <div class="col-md-4 text-center">
                <label for="dateOutPlanned">Client prévenu ?</label>
                <input type="checkbox" name="clientWarned" class="form-control">
                <a class="button small green button-3d rounded icon-right warnClient" data-target="#warnClient" data-toggle="modal" href="#">Prévenir le client</a>
              </div>
            </div>
            <div class="separator"></div>
            <div class="row manualWorkload">
              <div class="col-md-12">
                <h4 class="text-green">Main d'oeuvre : </h4>
              </div>
              <div class="col-md-12">
                <i class="fa fa-calculator"></i>
                <span class="manualWorkloadNumber">0</span>
                <input type="hidden" name="manualWorkloadNumber" value="0" />
                <button class="button small green button-3d rounded icon-right glyphicon glyphicon-plus" type="button"></button>
                <button class="button small red button-3d rounded icon-right glyphicon glyphicon-minus" style="display: none;" type="button"></button>
              </div>
              <table class="table table-condensed tableFixed manualWorkload">
                <thead>
                  <th class="col-md-2">Catégorie</th>
                  <th class="col-md-2">Description</th>
                  <th class="col-md-2">Durée (min)</th>
                  <th class="col-md-2">Total (€ HTVA)</th>
                  <th class="col-md-2">Total (€ TVAC)</th>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
            <div class="separator"></div>
            <div class="row maintenanceAccessories">
              <div class="col-md-12">
                <h4 class="text-green">Accessoires catalogue: </h4>
              </div>
              <div class="col-md-12 accessoriesButtons">
                <i class="fa fa-calculator"></i> <span class="accessoriesNumber">0</span>
                <button class="button small green button-3d rounded icon-right glyphicon glyphicon-plus" type="button"></button>
                <button class="button small red button-3d rounded icon-right glyphicon glyphicon-minus" style="display: none;" type="button"></button>
              </div>
              <table class="table table-condensed tableFixed accessoriesTable">
                <thead>
                  <th class="accessoriesCategory">
                    <label for="aCategory">Catégorie</label>
                  </th>
                  <th class="accessoriesAccessory">
                    <label for="aAccessory"">Accessoire</label>
                  </th>
                  <th class="accessoriesBuyingPrice">
                    <label for="aBuyingPrice">Prix achat</label>
                  </th>
                  <th class="accessoriesPriceHTVA">
                    <label for="aPriceHTVA">Prix Vente HTVA</label>
                  </th>
                  <th class="accessoriesPriceHTVA">
                    <label for="aPriceTVAC">Prix Vente TVAC</label>
                  </th>
                  <th>ID Stock
                  </th>
                  <th>Commentaire</th>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
            <div class="separator"></div>
            <div class="row otherAccessoriesMaintenance">
              <div class="col-md-12">
                <h4 class="text-green">Accessoires autres: </h4>
              </div>
              <div class="col-md-12">
                <i class="fa fa-calculator"></i> <span class="otherAccessoriesNumber">0</span>
                <button class="button small green button-3d rounded icon-right glyphicon glyphicon-plus" type="button"></button>
                <button class="button small red button-3d rounded icon-right glyphicon glyphicon-minus" style="display: none;" type="button"></button>
              </div>
              <table class="table table-condensed tableFixed otherAccessoriesTable">
                <thead>
                  <th class="otherAccessoryDescription" style='width:50%'>
                    <label for="otherAccessoryDescription">Description</label>
                  </th>
                  <th class="otherAccessoryHTVA">
                    <label for="otherAccessoryHTVA"">Prix HTVA</label>
                  </th>
                  <th class="otherAccessoryTVAC">
                    <label for="otherAccessoryTVAC">Prix TVAC</label>
                  </th>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>


            <div class="separator"></div>
            <h4 class="text-green">Informations pour client</h4>
            <div class="col-md-12">
              <label for="comment">Description</label>
              <textarea class="form-control" rows="5" name="comment" ></textarea>
            </div>
            <div class='space'></div>
            <div class="col-md-12" name="images">
            </div>
            <div class="col-md-12">
              <div name = "file" class="col-sm-6">
                <label for="publicFile">Ajouter une photo</label>
                <input type="hidden" name="MAX_FILE_SIZE" value="6291456">
                <input type="file" size="40" class="form-control" name="publicFile" accept="image/*,.pdf">
              </div>
            </div>
            <div class="separator"></div>
            <h4 class="text-green">Informations confidentielles</h4>
            <div class="col-md-12">
              <label for="internalComment">Description</label>
              <textarea class="form-control" rows="5" name="internalComment" ></textarea>
            </div>
            <div class='space'></div>
            <div class="col-md-12" name="internalImages">
            </div>
            <div class="col-md-12">
              <div name = "internalFile" class="col-sm-6">
                <label for="internalFile">Ajouter une photo</label>
                <input type="file" size="40" class="form-control" name="internalFile" accept="image/*,.pdf">
              </div>
            </div>
          </div>
          <input type="text" name="action" class="form-control hidden" value="update" />
          <input type="text" name="user" class="form-control hidden" value="<?php echo $user_data['EMAIL']; ?>"/>
          <input type="number" class="hidden" name='external' value="">

          <div class="col-sm-12">
            <button class="button small green button-3d rounded icon-left maintenanceManagementSendButton" type="submit">
              <i class="fa fa-paper-plane"></i><?= L::generic_confirm; ?>
            </button>
            <button class="button small red button-3d rounded icon-left maintenanceManagementDeleteButton" type="button">
              <i class="fa fa-paper-plane"></i><?= L::generic_delete; ?>
            </button>
          </div>
        </form>
        <script type="text/javascript">
          jQuery("#widget-maintenanceManagement-form").validate({
            submitHandler: function (form) {
              jQuery(form).ajaxSubmit({
                success: function (response) {
                  if (response.response == "success") {
                    $.notify(
                    {
                      message: response.message,
                    },
                    {
                      type: "success",
                    }
                    );
                    document
                    .getElementById("widget-maintenanceManagement-form")
                    .reset();
                    $("#maintenanceListingSpan").dataTable().api().ajax.reload();
                    $("#maintenanceManagementItem").modal("toggle");
                  } else {
                    $.notify(
                    {
                      message: response.message,
                    },
                    {
                      type: "danger",
                    }
                    );
                  }
                },
              });
            },
          });
        </script>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-b" data-dismiss="modal">
      <?= L::generic_close; ?>
    </button>
  </div>
</div>
</div>
</div>

<div class="modal fade" id="warnClient" tabindex="9" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none; overflow-y: auto !important">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      </div>
      <form id="widget-warnClient-form" action="api/maintenances" role="form" method="post">
        <div class='col-md-4'>
          <label for='warnByEmail'>Prévenir par mail ?</label>
          <input type='checkbox' class='form-control' name='warnByEmail' checked>
        </div>
        <div class='col-md-4'>
          <label for='emailAddress'>Adresse mail:</label>
          <select class='form-control required' name='emailAddress'></select>
        </div>
        <div class='separator'></div>
        <div class='col-md-4'>
          <label for='warnByPhone'>Prévenir par téléphone ?</label>
          <input type='checkbox' class='form-control' name='warnByPhone' checked>
        </div>
        <div class='col-md-4'>
          <label for='emailAddress'>Numéro:</label>
          <select class='form-control required' name='phoneNumber'></select>
        </div>
        <div class='separator'></div>
        <label for="message">Message</label>
        <textarea class="form-control" name='message' rows="3">Bonjour,&#13;&#10;Votre vélo est réparé est prêt dans nos locaux.&#13;&#10;&#10;Adresse: 8 Rue de la brasserie, 4000 Liège&#13;&#10;Numéro de téléphone: 04 290 71 21&#13;&#10;&#10;Bien à vous,&#13;&#10;Kameo Bikes</textarea>
        <button class="button small green button-3d rounded icon-left" type="submit">
          <i class="fa fa-paper-plane"></i><?= L::generic_confirm; ?>
        </button>
        <input type='text' name='maintenanceID' class='hidden'>
        <input type='text' name='action' class='hidden' value='sendCommunication'>
      </form>
      <div class="modal-footer"><button type="button" class="btn btn-b" data-dismiss="modal"><?= L::generic_close; ?></button></div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $('#widget-warnClient-form input[name=warnByEmail]').change(function(){
    if($(this).prop('checked')){
      $('#widget-warnClient-form select[name=emailAddress]').parent().removeClass("hidden");
    }else{
      $('#widget-warnClient-form select[name=emailAddress]').parent().addClass("hidden");
    }
  })

  $('#widget-warnClient-form input[name=warnByPhone]').change(function(){
    if($(this).prop('checked')){
      $('#widget-warnClient-form select[name=phoneNumber]').parent().removeClass("hidden")
    }else{
      $('#widget-warnClient-form select[name=phoneNumber]').parent().addClass("hidden")
    }
  })

  jQuery("#widget-warnClient-form").validate({
    submitHandler: function (form) {
      jQuery(form).ajaxSubmit({
        success: function (response) {
          if (response.response == "success") {
            $.notify(
            {
              message: response.message,
            },
            {
              type: "success",
            }
            );
            document.getElementById("widget-warnClient-form").reset();
            get_maintenance($('#maintenanceManagementItem input[name=ID]').val());
            $("#warnClient").modal("toggle");
          } else {
            $.notify(
            {
              message: response.message,
            },
            {
              type: "danger",
            }
            );
          }
        },
      });
    },
  });
</script>
