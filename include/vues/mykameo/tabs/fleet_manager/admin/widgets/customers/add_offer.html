<div class="modal fade" id="offerManagement" tabindex="-1" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none; overflow-y: auto !important; z-index: 2000">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-sm-12">
						<form id="widget-offerManagement-form" action="api/offers" role="form" method="post">
							<div class="form-group col-sm-12">
								<h4 class="text-green offerManagementTitle">Ajouter une offre</h4>
								<div class="col-sm-12">
									<div class="col-sm-12">
										<label for="title">Titre</label>
										<input type="text" name="title" class="form-control required">
									</div>
									<div class="col-sm-12">
										<label for="description">Description</label>
										<textarea class="form-control required" rows="5" name="description"></textarea>
									</div>
								</div>
								<div class="col-sm-12">
									<div class="col-sm-3">
										<label for="type">Type</label>
										<select name="type" class="form-control required">
											<option value="leasing">Location</option>
											<option value="achat">achat</option>
										</select>
									</div>
									<div class="col-sm-3">
										<label for="status">Status</label>
										<select name="status" class="form-control required">
											<option value="ongoing">En cours</option>
											<option value="done">Signé</option>
											<option value="lost">Perdu</option>
										</select>
									</div>
									<div class="col-sm-3">
										<label for="probability">Chance de réussite</label>
										<input type="number" min="0" max="100" name="probability" class="form-control required">
									</div>
									<div class="col-sm-3">
										<label for="amount">Montant</label>
										<input type="number" min="0" name="amount" class="form-control required">
									</div>
									<div class="col-sm-3">
										<label for="margin">Marge</label>
										<input type="number" min="0" name="margin" class="form-control">
									</div>
								</div>
								<div class="col-sm-12">
									<div class="col-sm-4">
										<label for="date">Date de signature</label>
										<input type="date" name="date" class="form-control">
									</div>
									<div class="col-sm-4">
										<label for="start">Date de début</label>
										<input type="date" name="start" class="form-control">
									</div>
									<div class="col-sm-4">
										<label for="end">Date de fin</label>
										<input type="date" name="end" class="form-control">
									</div>
								</div>
								<div class="separator offerManagementDetails"></div>
								<div class="col-sm-12 offerManagementDetails">
									<h4 class="text-green">Détails de l'offre</h4>
									<ul id='offerManagementDetails'>
									</ul>
								</div>
								<div class="separator offerManagementPDF"></div>
								<div class="col-sm-12 offerManagementPDF">
									<h4 class="text-green">Offre PDF</h4>
									<object data="" id='offerManagementPDF' type="application/pdf" width="100%" height="800px">
										<p>Apparemment vous n'avez pas un plug-in pour lire directement un fichier PDF. Vous pouvez <a href="resume.pdf">cliquer ici pour télécharger le fichier.</a></p>
									</object>
								</div>
								<br>
								<input type="hidden" id="companyHiddenOffer" name="company" class="form-control required hidden" value="">
								<input type="text" name="requestor" class="form-control required hidden" value="<?php echo $user_data['EMAIL']; ?>">
								<input type="text" name="action" class="form-control required hidden" value="addManualOffer">
								<input type="text" name="ID" class="hidden">
								<div class="separator"></div>
								<button  class="button small green button-3d rounded icon-left offerManagementSendButton" type="submit"><i class="fa fa-plus"></i>Ajouter</button>
								<a  class="button small red button-3d rounded icon-right hidden" id='offerManagementDelete'><i class="fa fa-plus"></i>Supprimer</a>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-b" data-dismiss="modal">Fermer</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	jQuery("#widget-offerManagement-form").off();
	jQuery("#widget-offerManagement-form").validate({
		submitHandler: function(form) {
			jQuery(form).ajaxSubmit({
				success: function(response) {
					if (response.response == 'success') {
						$.notify({
							message: response.message
						}, {
							type: 'success'
						});
						list_contracts_offers('*');
						document.getElementById('widget-offerManagement-form').reset();
						if ($('#widget-companyDetails-form input[name=ID]').val() != '') {
							get_company_details($('#widget-companyDetails-form input[name=ID]').val(), email);
						}
						$('#offerManagement').modal('toggle');
					} else {
						$.notify({
							message: response.message
						}, {
							type: 'danger'
						});
					}
				}
			});
		}
	});
	$("#widget-offerManagement-form select[name=type]").off();
	$("#widget-offerManagement-form select[name=type]").change(function() {
		if ($("#widget-offerManagement-form select[name=type]").val() == "achat") {
			$("#widget-offerManagement-form input[name=start]").val("");
			$("#widget-offerManagement-form input[name=end]").val("");
			$("#widget-offerManagement-form input[name=start]").attr("readonly", true);
			$("#widget-offerManagement-form input[name=end]").attr("readonly", true);
		}
		if ($("#widget-offerManagement-form select[name=type]").val() == "leasing") {
			$("#widget-offerManagement-form input[name=start]").attr("readonly", false);
			$("#widget-offerManagement-form input[name=end]").attr("readonly", false);
		}
	});

	$("#offerManagementDelete").off();
	$("#offerManagementDelete").click(function(){
	  $.ajax({
	    url: "api/companies",
	    method: "post",
	    data: { action: "deleteOffer", offerID: this.name },
	    success: function (response) {
	      if (response.response == "error") {
	        $.notify({
	          message: response.message
	        }, {
	          type: 'danger'
	        });
	      }else{
	        $.notify({
	          message: response.message
	        }, {
	          type: 'success'
	        });
					list_contracts_offers('*');
					document.getElementById('widget-offerManagement-form').reset();
					if ($('#widget-companyDetails-form input[name=ID]').val() != '') {
						get_company_details($('#widget-companyDetails-form input[name=ID]').val(), email);
					}
					$('#offerManagement').modal('toggle');
	      }
	    }
	  });
	});


</script>
